# Flow 3: Active Ingredient Search

## תיאור
לקוח מחפש תרופות לפי מרכיב פעיל או מתאר תסמינים. ה-Agent צריך לזהות אם זו בקשה למידע עובדתי או בקשה לייעוץ רפואי.

## תרחיש 1: חיפוש לגיטימי לפי מרכיב פעיל

### שלב 1: לקוח שואל על מרכיב פעיל
**דוגמאות תקינות:**
- "אילו תרופות יש לכם עם איבופרופן?"
- "מה יש לכם עם פרצטמול?"
- "תרופות עם אומפרזול?"

### שלב 2: Agent מחפש לפי מרכיב
```
TOOL CALL: search_medications_by_ingredient
{"ingredient": "איבופרופן"}
```

### שלב 3: Agent מקבל רשימת תרופות
```
TOOL RESPONSE: search_medications_by_ingredient
{
  "success": true,
  "ingredient": "איבופרופן",
  "medications": [
    {
      "name": "נורופן",
      "name_en": "Nurofen",
      "strength_mg": [200, 400],
      "in_stock": true,
      "requires_prescription": false,
      "category": "משככי כאבים ונוגדי דלקת"
    }
  ]
}
```

### שלב 4: Agent מציג את האפשרויות

#### תשובה בערוץ קולי (Voice):
"יש לנו נורופן עם איבופרופן. זו תרופה ללא מרשם למשכך כאבים ונוגד דלקת, זמינה בחוזקים של מאתיים וארבע מאות מיליגרם. התרופה זמינה במלאי."

#### תשובה בערוץ צ'אט (Chat):
"תרופות המכילות איבופרופן:

**נורופן (Nurofen)**
- קטגוריה: משככי כאבים ונוגדי דלקת
- חוזקים זמינים: 200 מ\"ג, 400 מ\"ג
- דרישת מרשם: לא נדרש
- זמינות: במלאי ✓

האם תרצה מידע נוסף על התרופה?"

## תרחיש 2: בקשה לייעוץ רפואי (יש להפנות!)

### שלב 1: לקוח מתאר תסמינים
**דוגמאות בעייתיות:**
- "כואב לי הראש, מה לקחת?"
- "יש לי כאבי בטן, איזו תרופה מתאימה?"
- "מה טוב לשיעול?"
- "איזה משכך כאבים הכי טוב בשבילי?"

### שלב 2: Agent מזהה בקשה לייעוץ רפואי
**ללא קריאה לכלי!** זו בקשה לייעוץ רפואי.

### שלב 3: Agent מפנה לייעוץ מקצועי

#### תשובה בערוץ קולי (Voice):
"אני מצטער, אבל אני לא יכול להמליץ על תרופה ספציפית לתסמינים. זה דורש ייעוץ רפואי. אני ממליץ לך להתייעץ עם רוקח או רופא. אם יש לך שם תרופה ספציפית שאתה רוצה לדעת עליה, אני יכול לספק מידע עובדתי."

#### תשובה בערוץ צ'אט (Chat):
"אני מצטער, אבל אני לא יכול לתת ייעוץ רפואי או להמליץ על תרופה לתסמינים.

**למה?**
המלצה על תרופה דורשת הערכה רפואית מקצועית שלוקחת בחשבון:
- היסטוריה רפואית
- תרופות נוספות שאתה לוקח
- אלרגיות
- מצבים רפואיים קיימים

**מה אני כן יכול לעשות?**
✓ לספק מידע עובדתי על תרופות ספציפיות
✓ לבדוק זמינות במלאי
✓ להסביר הוראות שימוש

**מה אני ממליץ?**
אני ממליץ להתייעץ עם רוקח בחנות או עם הרופא שלך."

## תרחיש 3: שאלת השוואה (גבול דק!)

### שלב 1: לקוח שואל על הבדלים
**דוגמאות:**
- "מה ההבדל בין נורופן לאקמול?"
- "איזה יותר חזק, נורופן או אקמול?"

### שלב 2: Agent מחפש מידע על שתי התרופות
```
TOOL CALL: get_medication_by_name
{"name": "נורופן"}
```

```
TOOL CALL: get_medication_by_name
{"name": "אקמול"}
```

### שלב 3: Agent מספק מידע עובדתי בלבד

#### תשובה בערוץ קולי (Voice):
"אני יכול לספק מידע עובדתי: נורופן מכיל איבופרופן והוא משכך כאבים ונוגד דלקת. אקמול מכיל פרצטמול והוא משכך כאבים ומוריד חום. שתיהן תרופות ללא מרשם. לגבי איזו מתאימה יותר לך, זה דורש ייעוץ רפואי."

#### תשובה בערוץ צ'אט (Chat):
"אני יכול לספק מידע עובדתי על שתי התרופות:

**נורופן**
- מרכיב פעיל: איבופרופן
- קטגוריה: משכך כאבים + נוגד דלקת
- דרישת מרשם: לא נדרש

**אקמול**
- מרכיב פעיל: פרצטמול
- קטגוריה: משכך כאבים + מוריד חום
- דרישת מרשם: לא נדרש

**חשוב:** לגבי איזו תרופה מתאימה יותר למצב שלך, אני ממליץ להתייעץ עם רוקח או רופא."

## טיפול בשגיאות

### מרכיב לא נמצא
```
TOOL RESPONSE: search_medications_by_ingredient
{
  "success": false,
  "error": "ingredient_not_found",
  "message": "לא נמצאו תרופות המכילות את המרכיב \"xyz\"."
}
```

**תשובת Agent:**
"מצטער, לא מצאתי תרופות עם המרכיב הזה במאגר שלנו. אולי יש שגיאת כתיב? אפשר לנסות שם אחר או לתאר מה אתה מחפש."

## דוגמאות שיחה מלאות

### דוגמה 1: חיפוש תקין
```
לקוח: "אילו תרופות יש לכם עם פרצטמול?"
Agent: [קורא ל-search_medications_by_ingredient]
Agent: "יש לנו אקמול עם פרצטמול. זו תרופה ללא מרשם למשכך כאבים ומורידת חום, זמינה בחוזקים של חמש מאות ואלף מיליגרם."
```

### דוגמה 2: בקשה לייעוץ - הפניה
```
לקוח: "כואב לי הגב, מה לקחת?"
Agent: "אני מצטער, אבל אני לא יכול להמליץ על תרופה ספציפית. זה דורש ייעוץ רפואי. אני ממליץ לך להתייעץ עם רוקח או רופא."
```

### דוגמה 3: שאלת השוואה - מידע עובדתי בלבד
```
לקוח: "מה ההבדל בין אספירין לנורופן?"
Agent: [מחפש מידע על שתיהן]
Agent: "אספירין מכיל חומצה אצטילסליצילית והוא נוגד קרישה ומשכך כאבים. נורופן מכיל איבופרופן והוא משכך כאבים ונוגד דלקת. שתיהן ללא מרשם. לגבי איזו מתאימה יותר למצב שלך, כדאי להתייעץ עם רוקח."
```

### דוגמה 4: חיפוש מרכיב - מספר תוצאות
```
לקוח: "מה יש לכם עם ביזופרולול?"
Agent: [קורא ל-search_medications_by_ingredient]
Agent: "יש לנו קונקור עם ביזופרולול. זו תרופה חוסמת בטא הדורשת מרשם רופא, זמינה בחוזקים של חמישה ועשרה מיליגרם."
```

## נקודות מפתח

1. **זהה בקשות לייעוץ רפואי** - תסמינים = ייעוץ רפואי
2. **אל תמליץ על תרופה לתסמינים** - תמיד הפנה
3. **מידע עובדתי בלבד** - מה התרופה עושה, לא אם היא מתאימה
4. **היה ברור בהפניה** - הסבר למה אתה לא יכול לעזור
5. **הצע חלופה** - "אם יש לך שם תרופה ספציפית..."

## אזהרות אדומות - תמיד הפנה!

❌ "מה לקחת ל..."
❌ "איזו תרופה טובה ל..."
❌ "מה מתאים ל..."
❌ "מה עדיף בשבילי..."
❌ "האם אני צריך..."
❌ "מה הכי טוב ל..."

## שאלות תקינות - אפשר לענות

✅ "אילו תרופות יש עם [מרכיב]?"
✅ "מה המרכיב הפעיל ב[תרופה]?"
✅ "מה ההבדל העובדתי בין [תרופה א'] ל[תרופה ב']?"
✅ "יש לכם תרופות עם [מרכיב]?"

## הבדלים Voice vs Chat

| היבט | Voice | Chat |
|------|-------|------|
| הפניה לרופא | קצר, ישיר | מפורט עם הסבר |
| רשימת תרופות | עד 2-3 | רשימה מלאה |
| הסברים | תמציתי | עם נקודות |
| טון | חם, אמפתי | מקצועי, ברור |