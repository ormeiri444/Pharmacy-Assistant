# Flow 2: Stock Check with Alternative Suggestion

## תיאור
לקוח בודק אם תרופה זמינה במלאי. אם התרופה לא במלאי, ה-Agent מציע תחליפים.

## שלבים

### שלב 1: לקוח שואל על זמינות
**דוגמאות:**
- "יש לכם אופטלגין במלאי?"
- "האם לופרסור זמין?"
- "אופטלגין יש?"

### שלב 2: Agent בודק זמינות
```
TOOL CALL: get_medication_by_name
{"name": "אופטלגין"}
```

### שלב 3: Agent מקבל תשובה - לא במלאי
```
TOOL RESPONSE: get_medication_by_name
{
  "success": true,
  "name": "אופטלגין",
  "active_ingredient": "דיפירון (מטמיזול)",
  "in_stock": false,
  "requires_prescription": false,
  "category": "משככי כאבים ומורידי חום"
}
```

### שלב 4: Agent מחפש תחליפים
```
TOOL CALL: get_alternative_medications
{"name": "אופטלגין"}
```

### שלב 5: Agent מקבל רשימת תחליפים
```
TOOL RESPONSE: get_alternative_medications
{
  "success": true,
  "original_medication": "אופטלגין",
  "alternatives": [
    {
      "name": "אקמול",
      "active_ingredient": "פרצטמול",
      "strength_mg": [500, 1000],
      "requires_prescription": false,
      "note": "תרופה אלטרנטיבית מאותה קטגוריה"
    },
    {
      "name": "נורופן",
      "active_ingredient": "איבופרופן",
      "strength_mg": [200, 400],
      "requires_prescription": false,
      "note": "תרופה אלטרנטיבית מאותה קטגוריה"
    }
  ],
  "note": "לא נמצאו תרופות עם אותו מרכיב פעיל. מוצגות תרופות מאותה קטגוריה."
}
```

### שלב 6: Agent מציע תחליפים ללקוח

#### תשובה בערוץ קולי (Voice):
"מצטער, אופטלגין לא זמין כרגע במלאי. אבל יש לי כמה תחליפים זמינים מאותה קטגוריה: אקמול עם פרצטמול, או נורופן עם איבופרופן. שתיהן תרופות ללא מרשם למשכך כאבים. האם תרצה לשמוע יותר על אחת מהן?"

#### תשובה בערוץ צ'אט (Chat):
"מצטער, אופטלגין אינו זמין כרגע במלאי.

**תחליפים זמינים:**

1. **אקמול**
   - מרכיב פעיל: פרצטמול
   - חוזקים: 500 מ\"ג, 1000 מ\"ג
   - דרישת מרשם: לא נדרש
   - זמין במלאי ✓

2. **נורופן**
   - מרכיב פעיל: איבופרופן
   - חוזקים: 200 מ\"ג, 400 מ\"ג
   - דרישת מרשם: לא נדרש
   - זמין במלאי ✓

שתי התרופות הן משככי כאבים ומורידי חום מאותה קטגוריה. האם תרצה מידע נוסף על אחת מהן?"

## תרחיש 2: תרופה במלאי

### שלב 1-3: בדיקה רגילה
```
לקוח: "יש לכם נורופן?"
Agent: [קורא ל-get_medication_by_name]
```

### שלב 4: תשובה חיובית
```
TOOL RESPONSE: get_medication_by_name
{
  "success": true,
  "name": "נורופן",
  "in_stock": true,
  "requires_prescription": false
}
```

#### תשובת Agent (Voice):
"כן, נורופן זמין במלאי. זו תרופה ללא מרשם."

#### תשובת Agent (Chat):
"כן, נורופן זמין במלאי ✓

זו תרופה ללא מרשם. האם תרצה מידע נוסף על התרופה?"

## תרחיש 3: תרופה דורשת מרשם

### בדיקת זמינות לתרופה במרשם
```
לקוח: "יש לכם ונטולין?"
Agent: [קורא ל-get_medication_by_name]
```

```
TOOL RESPONSE: get_medication_by_name
{
  "success": true,
  "name": "ונטולין",
  "in_stock": true,
  "requires_prescription": true
}
```

#### תשובת Agent (Voice):
"כן, ונטולין זמין במלאי, אבל חשוב לדעת שזו תרופה הדורשת מרשם רופא. תצטרך להביא מרשם כדי לרכוש אותה."

#### תשובת Agent (Chat):
"כן, ונטולין זמין במלאי ✓

**חשוב:** זו תרופה הדורשת מרשם רופא 📋

תצטרך להביא מרשם תקף כדי לרכוש את התרופה."

## טיפול בשגיאות

### תרופה לא קיימת במאגר
```
TOOL RESPONSE: get_medication_by_name
{
  "success": false,
  "error": "medication_not_found"
}
```

**תשובת Agent:**
"מצטער, לא מצאתי תרופה בשם זה במאגר שלנו. אולי יש שגיאת כתיב? אפשר לנסות שם אחר."

### אין תחליפים זמינים
```
TOOL RESPONSE: get_alternative_medications
{
  "success": true,
  "alternatives": []
}
```

**תשובת Agent:**
"מצטער, התרופה לא זמינה כרגע ואין לי תחליפים זמינים באותה קטגוריה. אני ממליץ להתייעץ עם הרוקח בחנות או לנסות שוב מאוחר יותר."

## דוגמאות שיחה מלאות

### דוגמה 1: תרופה לא במלאי עם תחליף
```
לקוח: "יש לכם לופרסור?"
Agent: [בודק זמינות]
Agent: "מצטער, לופרסור לא זמין כרגע. זו תרופה חוסמת בטא הדורשת מרשם. אני ממליץ להתייעץ עם הרוקח או הרופא שלך לגבי תחליפים מתאימים."
```

### דוגמה 2: תרופה במלאי, ללא מרשם
```
לקוח: "אקמול יש?"
Agent: [בודק זמינות]
Agent: "כן, אקמול זמין במלאי. זו תרופה ללא מרשם."
```

### דוגמה 3: תרופה במלאי, דורשת מרשם
```
לקוח: "קונקור זמין?"
Agent: [בודק זמינות]
Agent: "כן, קונקור זמין במלאי. זו תרופה הדורשת מרשם רופא. תצטרך להביא מרשם תקף."
```

## נקודות מפתח

1. **תמיד בדוק זמינות תחילה** - זה מה שהלקוח שאל
2. **אם לא במלאי, הצע תחליפים** - היה פרואקטיבי
3. **ציין דרישת מרשם** - זה קריטי לתכנון הלקוח
4. **אל תמליץ על תחליף ספציפי לתרופת מרשם** - זה ייעוץ רפואי
5. **היה ברור לגבי זמינות** - "כן" או "לא", לא "אולי"

## הבדלים Voice vs Chat

| היבט | Voice | Chat |
|------|-------|------|
| הצגת תחליפים | מקסימום 2-3 | רשימה מלאה |
| פירוט | שם + מרכיב פעיל | כל הפרטים |
| סימנים ויזואליים | לא | ✓, 📋, מספרים |
| שאלת המשך | כן, תמיד | כן, אופציונלי |